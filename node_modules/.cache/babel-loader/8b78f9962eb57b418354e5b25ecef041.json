{"ast":null,"code":"import _regeneratorRuntime from \"/Users/charlie/code/ex/exhiibeo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { Serializer } from '../../Serializer';\nimport { generateGUID } from '../../utils/generate-uuid';\nimport { Logger } from '../../utils/Logger';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { getQrData } from '../../utils/qr';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nimport { windowRef } from '../../MockWindow';\nimport { closeAlerts } from './Alert';\nimport { Pairing, WalletType } from './Pairing';\nvar logger = new Logger('Alert');\nvar serializer = new Serializer();\nexport var preparePairingAlert = function preparePairingAlert(id, shadowRoot, pairingPayload) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {\n    var getInfo, info, container, buttonListWrapper, showWallet, listContainer, showWalletLists, messageFn, _closeFn, qr, copyButton, titleEl, platform, mainText, walletList, switchButton, clipboardFn, qrShown, showPlatform, showQr, switchPlatform, platformSwitch;\n\n    return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n      while (1) {\n        switch (_context11.prev = _context11.next) {\n          case 0:\n            getInfo = function getInfo() {\n              return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        return _context3.abrupt(\"return\", Pairing.getPairingInfo(pairingPayload, function (_walletType, _wallet, keepOpen) {\n                          return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                            return _regeneratorRuntime.wrap(function _callee$(_context) {\n                              while (1) {\n                                switch (_context.prev = _context.next) {\n                                  case 0:\n                                    if (!keepOpen) {\n                                      _context.next = 2;\n                                      break;\n                                    }\n\n                                    return _context.abrupt(\"return\");\n\n                                  case 2:\n                                    _context.next = 4;\n                                    return closeAlerts();\n\n                                  case 4:\n                                  case \"end\":\n                                    return _context.stop();\n                                }\n                              }\n                            }, _callee);\n                          }));\n                        }, function () {\n                          return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                            return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                              while (1) {\n                                switch (_context2.prev = _context2.next) {\n                                  case 0:\n                                    switchPlatform();\n\n                                  case 1:\n                                  case \"end\":\n                                    return _context2.stop();\n                                }\n                              }\n                            }, _callee2);\n                          }));\n                        }));\n\n                      case 1:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n            };\n\n            _context11.next = 3;\n            return getInfo();\n\n          case 3:\n            info = _context11.sent;\n            container = shadowRoot.getElementById(\"pairing-container\");\n\n            if (container) {\n              _context11.next = 7;\n              break;\n            }\n\n            throw new Error('container not found');\n\n          case 7:\n            buttonListWrapper = document.createElement('span');\n            container.appendChild(buttonListWrapper);\n            info.buttons.forEach(function (button) {\n              return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n                var randomId, x, el, buttonEl;\n                return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                  while (1) {\n                    switch (_context5.prev = _context5.next) {\n                      case 0:\n                        _context5.next = 2;\n                        return generateGUID();\n\n                      case 2:\n                        randomId = _context5.sent;\n                        x = \"\\n    <div class=\\\"beacon-list__title\\\">\".concat(button.title, \"</div>\\n\\t\\t<button class=\\\"beacon-modal__button connect__btn\\\">\").concat(button.text, \"</button>\\n\\t\\t \");\n                        el = document.createElement('a');\n                        el.id = \"button_\".concat(randomId);\n                        el.innerHTML = x;\n                        buttonListWrapper.appendChild(el);\n                        buttonEl = shadowRoot.getElementById(el.id);\n\n                        if (buttonEl) {\n                          buttonEl.addEventListener('click', function () {\n                            return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n                              return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                                while (1) {\n                                  switch (_context4.prev = _context4.next) {\n                                    case 0:\n                                      button.clickHandler();\n\n                                    case 1:\n                                    case \"end\":\n                                      return _context4.stop();\n                                  }\n                                }\n                              }, _callee4);\n                            }));\n                          });\n                        }\n\n                      case 10:\n                      case \"end\":\n                        return _context5.stop();\n                    }\n                  }\n                }, _callee5);\n              }));\n            });\n\n            showWallet = function showWallet(listEl, type, wallet) {\n              var altTag = \"Open in \".concat(wallet.name);\n              var walletKey = wallet.key;\n              var x = \"\\n    <a tabindex=\\\"0\\\" alt=\\\"\".concat(altTag, \"\\\" id=\\\"wallet_\").concat(walletKey, \"\\\"\\n     target=\\\"_blank\\\" class=\\\"beacon-selection__list\").concat(wallet.enabled ? '' : ' disabled', \"\\\">\\n     <div class=\\\"beacon-selection__name\\\">\").concat(wallet.name, \"\\n     \").concat(wallet.enabled ? '' : '<p>Not installed</p>', \"\\n     </div>\\n     \").concat(wallet.logo ? \"<div>\\n     <img class=\\\"beacon-selection__img\\\" src=\\\"\".concat(wallet.logo, \"\\\"/>\\n     </div>\") : '<svg class=\"beacon-selection__img\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"wallet\" class=\"svg-inline--fa fa-wallet fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" style=\"enable-background:new 0 0 512 512;\" xml:space=\"preserve\"><path d=\"M376.2,181H152.9c-5.2,0-9.4-4.2-9.4-9.4s4.2-9.4,9.4-9.4h225c5.2,0,9.4-4.2,9.4-9.4c0-15.5-12.6-28.1-28.1-28.1H143.5c-20.7,0-37.5,16.8-37.5,37.5v187.5c0,20.7,16.8,37.5,37.5,37.5h232.7c16.4,0,29.8-12.6,29.8-28.1v-150C406,193.6,392.7,181,376.2,181z M349.8,302.9c-10.4,0-18.8-8.4-18.8-18.8s8.4-18.8,18.8-18.8s18.8,8.4,18.8,18.8S360.1,302.9,349.8,302.9z\"/></svg>', \"\\n    </a>\\n     \");\n              var el = document.createElement('span');\n              el.innerHTML = x;\n              listEl.appendChild(el);\n              var walletEl = shadowRoot.getElementById(\"wallet_\".concat(walletKey));\n\n              var completeHandler = function completeHandler(event) {\n                return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n                  var modalEl;\n                  return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                    while (1) {\n                      switch (_context6.prev = _context6.next) {\n                        case 0:\n                          if (!(event && event.key !== 'Enter')) {\n                            _context6.next = 2;\n                            break;\n                          }\n\n                          return _context6.abrupt(\"return\");\n\n                        case 2:\n                          wallet.clickHandler();\n                          modalEl = shadowRoot.getElementById('beacon-modal__content');\n\n                          if (modalEl && type !== WalletType.EXTENSION && type !== WalletType.IOS) {\n                            modalEl.innerHTML = \"\".concat(wallet.logo ? \"<p class=\\\"beacon-alert__title\\\">Establishing Connection..</p>\\n            <div id=\\\"beacon-toast-loader\\\" class=\\\"progress-line\\\"></div>\\n            <div class=\\\"beacon--selected__container\\\">\\n             <img class=\\\"beacon-selection__img\\\" src=\\\"\".concat(wallet.logo, \"\\\"/>\\n             <div class=\\\"beacon--selection__name__lg\\\">\").concat(wallet.name, \"</div>\\n            </div>\") : '', \"\\n        \");\n                          }\n\n                        case 5:\n                        case \"end\":\n                          return _context6.stop();\n                      }\n                    }\n                  }, _callee6);\n                }));\n              };\n\n              if (walletEl) {\n                walletEl.addEventListener('click', function () {\n                  return completeHandler();\n                });\n                walletEl.addEventListener('keydown', completeHandler);\n              }\n            };\n\n            listContainer = document.createElement('span');\n            container.appendChild(listContainer);\n\n            showWalletLists = function showWalletLists(walletLists) {\n              listContainer.innerHTML = '';\n              walletLists.forEach(function (list) {\n                var listWrapperEl = document.createElement('div');\n                listWrapperEl.classList.add('beacon-list__wrapper');\n                listContainer.appendChild(listWrapperEl);\n                var listTitleEl = document.createElement('div');\n                listTitleEl.classList.add('beacon-list__title');\n                listTitleEl.innerHTML = list.title;\n                listWrapperEl.appendChild(listTitleEl);\n                var listEl = document.createElement('span');\n                listWrapperEl.appendChild(listEl);\n                list.wallets.forEach(function (wallet) {\n                  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n                    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n                      while (1) {\n                        switch (_context7.prev = _context7.next) {\n                          case 0:\n                            showWallet(listEl, list.type, wallet);\n\n                          case 1:\n                          case \"end\":\n                            return _context7.stop();\n                        }\n                      }\n                    }, _callee7);\n                  }));\n                });\n              });\n            };\n\n            showWalletLists(info.walletLists); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n            messageFn = function messageFn(event) {\n              return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n                var newInfo;\n                return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n                  while (1) {\n                    switch (_context8.prev = _context8.next) {\n                      case 0:\n                        if (!(event.data === 'extensionsUpdated')) {\n                          _context8.next = 5;\n                          break;\n                        }\n\n                        _context8.next = 3;\n                        return getInfo();\n\n                      case 3:\n                        newInfo = _context8.sent;\n                        showWalletLists(newInfo.walletLists);\n\n                      case 5:\n                      case \"end\":\n                        return _context8.stop();\n                    }\n                  }\n                }, _callee8);\n              }));\n            }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            _closeFn = function closeFn(event) {\n              if (event.data === \"closeAlert-\".concat(id)) {\n                windowRef.removeEventListener('message', messageFn);\n                windowRef.removeEventListener('message', _closeFn);\n              }\n            };\n\n            windowRef.addEventListener('message', messageFn);\n            windowRef.addEventListener('message', _closeFn);\n            qr = shadowRoot.getElementById(\"beacon--qr__container\");\n            copyButton = shadowRoot.getElementById(\"beacon--qr__copy\");\n            titleEl = shadowRoot.getElementById(\"beacon-title\");\n            platform = isAndroid(window) ? 'android' : isIOS(window) ? 'ios' : 'desktop';\n            mainText = shadowRoot.getElementById(\"beacon-main-text\");\n            walletList = shadowRoot.getElementById(\"pairing-container\");\n            switchButton = shadowRoot.getElementById(\"beacon--switch__container\"); // if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n\n            clipboardFn = function clipboardFn() {\n              return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n                var code;\n                return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n                  while (1) {\n                    switch (_context9.prev = _context9.next) {\n                      case 0:\n                        if (!pairingPayload) {\n                          _context9.next = 10;\n                          break;\n                        }\n\n                        _context9.t1 = serializer;\n                        _context9.next = 4;\n                        return pairingPayload.p2pSyncCode();\n\n                      case 4:\n                        _context9.t2 = _context9.sent;\n                        _context9.next = 7;\n                        return _context9.t1.serialize.call(_context9.t1, _context9.t2);\n\n                      case 7:\n                        _context9.t0 = _context9.sent;\n                        _context9.next = 11;\n                        break;\n\n                      case 10:\n                        _context9.t0 = '';\n\n                      case 11:\n                        code = _context9.t0;\n                        navigator.clipboard.writeText(code).then(function () {\n                          if (copyButton) {\n                            copyButton.innerText = 'Copied';\n                          }\n\n                          logger.log('Copying to clipboard was successful!');\n                        }, function (err) {\n                          logger.error('Could not copy text to clipboard: ', err);\n                        });\n\n                      case 13:\n                      case \"end\":\n                        return _context9.stop();\n                    }\n                  }\n                }, _callee9);\n              }));\n            };\n\n            qrShown = false;\n\n            showPlatform = function showPlatform(type) {\n              return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n                var platformSwitch, code, uri, qrSVG, qrString;\n                return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n                  while (1) {\n                    switch (_context10.prev = _context10.next) {\n                      case 0:\n                        platformSwitch = shadowRoot.getElementById(\"beacon-switch\");\n\n                        if (platformSwitch) {\n                          platformSwitch.innerHTML = type === 'none' ? 'Pair wallet on same device' : 'Pair wallet on another device';\n                        }\n\n                        if (!(mainText && walletList && switchButton && copyButton && qr && titleEl)) {\n                          _context10.next = 35;\n                          break;\n                        }\n\n                        mainText.style.display = 'none';\n                        titleEl.style.textAlign = 'center';\n                        walletList.style.display = 'none';\n                        switchButton.style.display = 'initial';\n                        _context10.t0 = type;\n                        _context10.next = _context10.t0 === 'ios' ? 10 : _context10.t0 === 'android' ? 12 : _context10.t0 === 'desktop' ? 14 : 19;\n                        break;\n\n                      case 10:\n                        walletList.style.display = 'initial';\n                        return _context10.abrupt(\"break\", 35);\n\n                      case 12:\n                        walletList.style.display = 'initial';\n                        return _context10.abrupt(\"break\", 35);\n\n                      case 14:\n                        walletList.style.display = 'initial';\n                        titleEl.style.textAlign = 'left';\n                        mainText.style.display = 'none';\n                        switchButton.style.display = 'initial';\n                        return _context10.abrupt(\"break\", 35);\n\n                      case 19:\n                        if (qrShown) {\n                          _context10.next = 34;\n                          break;\n                        }\n\n                        _context10.t1 = serializer;\n                        _context10.next = 23;\n                        return pairingPayload.p2pSyncCode();\n\n                      case 23:\n                        _context10.t2 = _context10.sent;\n                        _context10.next = 26;\n                        return _context10.t1.serialize.call(_context10.t1, _context10.t2);\n\n                      case 26:\n                        code = _context10.sent;\n                        uri = getTzip10Link('tezos://', code);\n                        qrSVG = getQrData(uri, 'svg');\n                        qrString = qrSVG.replace('<svg', \"<svg class=\\\"beacon-alert__image\\\"\");\n                        qr.insertAdjacentHTML('afterbegin', qrString);\n\n                        if (copyButton) {\n                          copyButton.addEventListener('click', clipboardFn);\n                        }\n\n                        if (qr) {\n                          qr.addEventListener('click', clipboardFn);\n                        }\n\n                        qrShown = true;\n\n                      case 34:\n                        // QR code\n                        mainText.style.display = 'initial';\n\n                      case 35:\n                      case \"end\":\n                        return _context10.stop();\n                    }\n                  }\n                }, _callee10);\n              }));\n            };\n\n            showQr = false;\n\n            switchPlatform = function switchPlatform() {\n              showPlatform(showQr ? 'none' : platform);\n              showQr = !showQr;\n            };\n\n            switchPlatform();\n            platformSwitch = shadowRoot.getElementById(\"beacon-switch\");\n\n            if (platformSwitch) {\n              platformSwitch.addEventListener('click', switchPlatform);\n            }\n\n          case 34:\n          case \"end\":\n            return _context11.stop();\n        }\n      }\n    }, _callee11);\n  }));\n};","map":{"version":3,"sources":["../../../../src/ui/alert/PairingAlert.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Serializer } from '../../Serializer';\nimport { generateGUID } from '../../utils/generate-uuid';\nimport { Logger } from '../../utils/Logger';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { getQrData } from '../../utils/qr';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nimport { windowRef } from '../../MockWindow';\nimport { closeAlerts } from './Alert';\nimport { Pairing, WalletType } from './Pairing';\nconst logger = new Logger('Alert');\nconst serializer = new Serializer();\nexport const preparePairingAlert = (id, shadowRoot, pairingPayload) => __awaiter(void 0, void 0, void 0, function* () {\n    const getInfo = () => __awaiter(void 0, void 0, void 0, function* () {\n        return Pairing.getPairingInfo(pairingPayload, (_walletType, _wallet, keepOpen) => __awaiter(void 0, void 0, void 0, function* () {\n            if (keepOpen) {\n                return;\n            }\n            yield closeAlerts();\n        }), () => __awaiter(void 0, void 0, void 0, function* () {\n            switchPlatform();\n        }));\n    });\n    const info = yield getInfo();\n    const container = shadowRoot.getElementById(`pairing-container`);\n    if (!container) {\n        throw new Error('container not found');\n    }\n    const buttonListWrapper = document.createElement('span');\n    container.appendChild(buttonListWrapper);\n    info.buttons.forEach((button) => __awaiter(void 0, void 0, void 0, function* () {\n        const randomId = yield generateGUID();\n        const x = `\n    <div class=\"beacon-list__title\">${button.title}</div>\n\t\t<button class=\"beacon-modal__button connect__btn\">${button.text}</button>\n\t\t `;\n        const el = document.createElement('a');\n        el.id = `button_${randomId}`;\n        el.innerHTML = x;\n        buttonListWrapper.appendChild(el);\n        const buttonEl = shadowRoot.getElementById(el.id);\n        if (buttonEl) {\n            buttonEl.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n                button.clickHandler();\n            }));\n        }\n    }));\n    const showWallet = (listEl, type, wallet) => {\n        const altTag = `Open in ${wallet.name}`;\n        const walletKey = wallet.key;\n        const x = `\n    <a tabindex=\"0\" alt=\"${altTag}\" id=\"wallet_${walletKey}\"\n     target=\"_blank\" class=\"beacon-selection__list${wallet.enabled ? '' : ' disabled'}\">\n     <div class=\"beacon-selection__name\">${wallet.name}\n     ${wallet.enabled ? '' : '<p>Not installed</p>'}\n     </div>\n     ${wallet.logo\n            ? `<div>\n     <img class=\"beacon-selection__img\" src=\"${wallet.logo}\"/>\n     </div>`\n            : '<svg class=\"beacon-selection__img\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"wallet\" class=\"svg-inline--fa fa-wallet fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" style=\"enable-background:new 0 0 512 512;\" xml:space=\"preserve\"><path d=\"M376.2,181H152.9c-5.2,0-9.4-4.2-9.4-9.4s4.2-9.4,9.4-9.4h225c5.2,0,9.4-4.2,9.4-9.4c0-15.5-12.6-28.1-28.1-28.1H143.5c-20.7,0-37.5,16.8-37.5,37.5v187.5c0,20.7,16.8,37.5,37.5,37.5h232.7c16.4,0,29.8-12.6,29.8-28.1v-150C406,193.6,392.7,181,376.2,181z M349.8,302.9c-10.4,0-18.8-8.4-18.8-18.8s8.4-18.8,18.8-18.8s18.8,8.4,18.8,18.8S360.1,302.9,349.8,302.9z\"/></svg>'}\n    </a>\n     `;\n        const el = document.createElement('span');\n        el.innerHTML = x;\n        listEl.appendChild(el);\n        const walletEl = shadowRoot.getElementById(`wallet_${walletKey}`);\n        const completeHandler = (event) => __awaiter(void 0, void 0, void 0, function* () {\n            if (event && event.key !== 'Enter') {\n                return;\n            }\n            wallet.clickHandler();\n            const modalEl = shadowRoot.getElementById('beacon-modal__content');\n            if (modalEl && type !== WalletType.EXTENSION && type !== WalletType.IOS) {\n                modalEl.innerHTML = `${wallet.logo\n                    ? `<p class=\"beacon-alert__title\">Establishing Connection..</p>\n            <div id=\"beacon-toast-loader\" class=\"progress-line\"></div>\n            <div class=\"beacon--selected__container\">\n             <img class=\"beacon-selection__img\" src=\"${wallet.logo}\"/>\n             <div class=\"beacon--selection__name__lg\">${wallet.name}</div>\n            </div>`\n                    : ''}\n        `;\n            }\n        });\n        if (walletEl) {\n            walletEl.addEventListener('click', () => completeHandler());\n            walletEl.addEventListener('keydown', completeHandler);\n        }\n    };\n    const listContainer = document.createElement('span');\n    container.appendChild(listContainer);\n    const showWalletLists = (walletLists) => {\n        listContainer.innerHTML = '';\n        walletLists.forEach((list) => {\n            const listWrapperEl = document.createElement('div');\n            listWrapperEl.classList.add('beacon-list__wrapper');\n            listContainer.appendChild(listWrapperEl);\n            const listTitleEl = document.createElement('div');\n            listTitleEl.classList.add('beacon-list__title');\n            listTitleEl.innerHTML = list.title;\n            listWrapperEl.appendChild(listTitleEl);\n            const listEl = document.createElement('span');\n            listWrapperEl.appendChild(listEl);\n            list.wallets.forEach((wallet) => __awaiter(void 0, void 0, void 0, function* () {\n                showWallet(listEl, list.type, wallet);\n            }));\n        });\n    };\n    showWalletLists(info.walletLists);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const messageFn = (event) => __awaiter(void 0, void 0, void 0, function* () {\n        if (event.data === 'extensionsUpdated') {\n            const newInfo = yield getInfo();\n            showWalletLists(newInfo.walletLists);\n        }\n    });\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let closeFn;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    closeFn = (event) => {\n        if (event.data === `closeAlert-${id}`) {\n            windowRef.removeEventListener('message', messageFn);\n            windowRef.removeEventListener('message', closeFn);\n        }\n    };\n    windowRef.addEventListener('message', messageFn);\n    windowRef.addEventListener('message', closeFn);\n    const qr = shadowRoot.getElementById(`beacon--qr__container`);\n    const copyButton = shadowRoot.getElementById(`beacon--qr__copy`);\n    const titleEl = shadowRoot.getElementById(`beacon-title`);\n    const platform = isAndroid(window) ? 'android' : isIOS(window) ? 'ios' : 'desktop';\n    const mainText = shadowRoot.getElementById(`beacon-main-text`);\n    const walletList = shadowRoot.getElementById(`pairing-container`);\n    const switchButton = shadowRoot.getElementById(`beacon--switch__container`);\n    // if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n    const clipboardFn = () => __awaiter(void 0, void 0, void 0, function* () {\n        const code = pairingPayload\n            ? yield serializer.serialize(yield pairingPayload.p2pSyncCode())\n            : '';\n        navigator.clipboard.writeText(code).then(() => {\n            if (copyButton) {\n                copyButton.innerText = 'Copied';\n            }\n            logger.log('Copying to clipboard was successful!');\n        }, (err) => {\n            logger.error('Could not copy text to clipboard: ', err);\n        });\n    });\n    let qrShown = false;\n    const showPlatform = (type) => __awaiter(void 0, void 0, void 0, function* () {\n        const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n        if (platformSwitch) {\n            platformSwitch.innerHTML =\n                type === 'none' ? 'Pair wallet on same device' : 'Pair wallet on another device';\n        }\n        if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n            mainText.style.display = 'none';\n            titleEl.style.textAlign = 'center';\n            walletList.style.display = 'none';\n            switchButton.style.display = 'initial';\n            switch (type) {\n                case 'ios':\n                    walletList.style.display = 'initial';\n                    break;\n                case 'android':\n                    walletList.style.display = 'initial';\n                    break;\n                case 'desktop':\n                    walletList.style.display = 'initial';\n                    titleEl.style.textAlign = 'left';\n                    mainText.style.display = 'none';\n                    switchButton.style.display = 'initial';\n                    break;\n                default:\n                    if (!qrShown) {\n                        const code = yield serializer.serialize(yield pairingPayload.p2pSyncCode());\n                        const uri = getTzip10Link('tezos://', code);\n                        const qrSVG = getQrData(uri, 'svg');\n                        const qrString = qrSVG.replace('<svg', `<svg class=\"beacon-alert__image\"`);\n                        qr.insertAdjacentHTML('afterbegin', qrString);\n                        if (copyButton) {\n                            copyButton.addEventListener('click', clipboardFn);\n                        }\n                        if (qr) {\n                            qr.addEventListener('click', clipboardFn);\n                        }\n                        qrShown = true;\n                    }\n                    // QR code\n                    mainText.style.display = 'initial';\n            }\n        }\n    });\n    let showQr = false;\n    const switchPlatform = () => {\n        showPlatform(showQr ? 'none' : platform);\n        showQr = !showQr;\n    };\n    switchPlatform();\n    {\n        const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n        if (platformSwitch) {\n            platformSwitch.addEventListener('click', switchPlatform);\n        }\n    }\n});\n//# sourceMappingURL=PairingAlert.js.map"]},"metadata":{},"sourceType":"module"}